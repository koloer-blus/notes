<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://avatars.githubusercontent.com/u/77950278?s=120&v=4"><title>浏览器输入URL网址发生的事情 | 白子煜 | 个人小站</title><meta name="description" content="白子煜个人笔记">
    <link rel="modulepreload" href="/notes/assets/app.07af11fc.js"><link rel="modulepreload" href="/notes/assets/浏览器-输入URL网址发生的事情.html.997b2712.js"><link rel="modulepreload" href="/notes/assets/浏览器-输入URL网址发生的事情.html.c1bec228.js">
    <link rel="stylesheet" href="/notes/assets/style.42c3c254.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notes/" class=""><!----><span class="site-name">白子煜 | 个人小站</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/notes/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://juejin.cn/user/870468941264270/posts" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/baiziyu-fe/notes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/notes/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://juejin.cn/user/870468941264270/posts" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/baiziyu-fe/notes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">浏览器输入URL网址发生的事情 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#前置知识" class="router-link-active router-link-exact-active sidebar-item" aria-label="前置知识"><!--[--><!--]--> 前置知识 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#进程与线程" class="router-link-active router-link-exact-active sidebar-item" aria-label="进程与线程"><!--[--><!--]--> 进程与线程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#浏览器架构" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器架构"><!--[--><!--]--> 浏览器架构 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#简述版" class="router-link-active router-link-exact-active sidebar-item" aria-label="简述版"><!--[--><!--]--> 简述版 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#详细版" class="router-link-active router-link-exact-active sidebar-item" aria-label="详细版"><!--[--><!--]--> 详细版 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%BE%93%E5%85%A5URL%E7%BD%91%E5%9D%80%E5%8F%91%E7%94%9F%E7%9A%84%E4%BA%8B%E6%83%85.html#参考" class="router-link-active router-link-exact-active sidebar-item" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="浏览器输入url网址发生的事情" tabindex="-1"><a class="header-anchor" href="#浏览器输入url网址发生的事情" aria-hidden="true">#</a> 浏览器输入URL网址发生的事情</h1><h2 id="前置知识" tabindex="-1"><a class="header-anchor" href="#前置知识" aria-hidden="true">#</a> 前置知识</h2><h3 id="进程与线程" tabindex="-1"><a class="header-anchor" href="#进程与线程" aria-hidden="true">#</a> 进程与线程</h3><ul><li><p>进程可以被描述为一个应用程序的执行程序，线程是存在于进程内部并执行其进程程序的任何部分的线程。</p></li><li><p>进程之间相互独立，同一个进程中的各个线程互相协作，共享一块内存空间。</p></li></ul><h3 id="浏览器架构" tabindex="-1"><a class="header-anchor" href="#浏览器架构" aria-hidden="true">#</a> 浏览器架构</h3><p>浏览器时多进程的，有一个主控进程，以及每一个<code>tab</code>页面都会打开一个新的进程，多个<code>tab</code>会在满足一定条件下合并进程。</p><ul><li><code>Browser</code>：浏览器进程，控制应用程序的“chrome”部分，包括地址栏、书签、后退和前进按钮。还处理 Web 浏览器的不可见的特权部分，例如网络请求和文件访问。</li><li><code>Renderer</code>：渲染器进程，控制显示网站的选项卡内的任何内容。</li><li><code>Plugin</code>：插件进程，控制网站使用的任何插件，例如 flash。</li><li><code>GPU</code>：图形处理进程，独立于其他进程处理 <code>GPU</code> 任务。它被分成不同的进程，因为 <code>GPU</code> 处理来自多个应用程序的请求并将它们绘制在同一个表面上。</li></ul><h4 id="多进程的好处" tabindex="-1"><a class="header-anchor" href="#多进程的好处" aria-hidden="true">#</a> 多进程的好处</h4><ol><li><p>避免单个<code>Tab</code>影响整个浏览器；</p></li><li><p>避免插件影响整个浏览器；</p></li><li><p>多进程可以高效利用多核优势；</p><p>进程有自己的私有内存空间，所以他们通常包含公共基础设施的副本。意味着需要更多的内存使用量，因为如果他们是同一进程内的线程，则无法像他们那样共享它们。为了节省内存，chrome限制了它可以启动的进程数。</p></li><li><p>方便使用沙盒模型隔离插件等进程，提高浏览器稳定性。</p></li></ol><h2 id="简述版" tabindex="-1"><a class="header-anchor" href="#简述版" aria-hidden="true">#</a> 简述版</h2><ol><li><code>URL</code> 解析</li><li><code>DNS</code>解析</li><li>建立 <code>TCP</code> 连接</li><li>发送 <code>HTTP</code> 请求</li><li>服务器处理并返回 <code>HTTP</code> 报文</li><li>浏览器解析渲染页面</li><li>连接结束</li></ol><h2 id="详细版" tabindex="-1"><a class="header-anchor" href="#详细版" aria-hidden="true">#</a> 详细版</h2><ol><li><p><code>URL</code> 解析</p><blockquote><p>为什么做URL解析？</p><ul><li>网络标准规定了URL只能是字母和数字，还有一写其他符号。转码的过程使用的是<code>encodeURIComponent</code>进行转码，区别于<code>encodeURI</code>只适用于URL，前者更适用于参数编码</li></ul></blockquote><ul><li>输入URL后，浏览器会解析出协议、主机、端口、路径等信息，并构造一个HTTP请求。</li><li>浏览器发送请求前，根据请求头的<code>expires</code>和<code>cache-control</code>判断是否命中（包括是否过期）强缓存策略，如果命中，直接从缓存获取资源，并不会发送请求。如果没有命中，则进入下一步。</li><li>没有命中强缓存规则，浏览器会发送请求，根据请求头的<code>If-Modified-Since</code>和<code>If-None-Match</code>判断是否命中协商缓存，如果命中，直接从缓存获取资源。如果没有命中，则进入下一步。</li><li>如果前两步都没有命中，则直接从服务端获取资源。</li></ul></li><li><p><code>DNS</code>解析</p><ul><li>在解析过程中，按照<code>浏览器缓存</code>、<code>系统缓存</code>、<code>路由器缓存</code>、<code>ISP(运营商)DNS缓存</code>、<code>根域名服务器</code>、<code>顶级域名服务器</code>、<code>主域名服务器</code>的顺序，逐步读取缓存，直到拿到<code>IP</code>地址 <ul><li>检查hosts文件是否有记录，如果有返回对应的映射<code>IP</code></li><li>hosts文件没有就去查本地<code>dns</code>解析器有没有缓存</li><li>然后就去找我们计算机上配置的<code>dns</code>服务器上是否有缓存</li><li>如果还没有的话就去找根<code>dns</code>服务器，然后判断是具体哪个服务器管理，如果无法解析，就去查找<code>.test.com</code>是否能解析，知道查到对应的<code>IP</code>地址</li></ul></li><li><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20fcf62b9dc24b57a977d42efb9c8f43~tplv-k3u1fbpfcp-watermark.awebp" alt=""></li></ul></li><li><p><code>Tcp/Ip</code>请求（三次握手）</p><ul><li><p><code>TCP</code>协议是面向连接的，所以它在开始传输数据之前需要先建立连接。要建立或初始化一个连接，两端主机必须同步双方的初始序号。同步是通过交换连接建立数据分段和初始序号来完成的，在连接建立数据分段中包含一个<code>SYN</code>(同步)的控制位。同步需要双方都发送自己的初始序号，并且发送确认的<code>ACK</code>。此过程就是三次握手</p><ul><li>客户端发送<code>syn</code>包(<code>Seq=x</code>)到服务器，并进入<code>SYN_SEND</code>状态，等待服务器确认；</li><li>服务器收到<code>syn</code>包，必须确认客户的<code>SYN</code>（<code>ack=x+1</code>），同时自己也发送一个<code>SYN</code>包（<code>Seq=y</code>），即<code>SYN+ACK</code>包，此时服务器进入<code>SYN_RECV</code>状态；</li><li>客户端收到服务器的<code>SYN＋ACK</code>包，向服务器发送确认包<code>ACK</code>(<code>ack=y+1</code>)，此包发送完毕，客户端和服务器进入<code>ESTABLISHED</code>状态，完成三次握手。</li></ul></li><li><p>握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。</p><ul><li>采用三次握手是为了防止失效的连接请求报文段突然又传送到主机B，因而产生错误。失效的连接请求报文段是指：主机A发出的连接请求没有收到主机B的确认，于是经过一段时间后，主机A又重新向主机B发送连接请求，且建立成功，顺序完成数据传输。考虑这样一种特殊情况，主机A第一次发送的连接请求并没有丢失，而是因为网络节点导致延迟达到主机B，主机B以为是主机A又发起的新连接，于是主机B同意连接，并向主机A发回确认，但是此时主机A根本不会理会，主机B就一直在等待主机A发送数据，导致主机B的资源浪费。</li><li><strong>采用两次握手不行，原因就是上面说的失效的连接请求的特殊情况</strong>。而在三次握手中， <code>client</code>和<code>server</code>都有一个发<code>syn</code>和收<code>ack</code>的过程， 双方都是发后能收， 表明通信则准备工作完成。</li><li><strong>采用四次握手没必要</strong>。而上面的三次握手已经做好了通信的准备工作， 再增加握手， 并不能显著提高可靠性</li></ul></li><li><p>浏览器对同一域名下并发的<code>Tcp</code>连接有一定限制</p></li></ul></li><li><p>发送<code>HTTP</code>请求</p><blockquote><p><code>HTTP</code>的端口为80/8080，而<code>HTTPS</code>的端口为443</p></blockquote><ul><li><p>发送HTTP请求的过程就是构建HTTP请求报文并通过TCP协议中发送到服务器指定端口 请求报文由<strong>请求行</strong>，<strong>请求报头</strong>，<strong>请求正文</strong>组成。</p></li><li><p>请求行</p><ul><li>格式为<code>Method Request-URL HTTP-Version CRLF</code> <code>eg: GET index.html HTTP/1.1</code></li><li>常用的方法有: <code>GET</code>,<code> POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>OPTIONS</code>, <code>HEAD</code>。 <ul><li>GET、POST区别（<code>GET</code>会产生一个<code>TCP</code>数据包，而<code>POST</code>会产生两个<code>TCP</code>数据包。）</li><li><strong>并不是所有的浏览器都会发送两次数据包，Firefox就发送一次</strong></li></ul></li></ul></li><li><p>请求报头</p><ul><li>请求报头允许客户端向服务器传递请求的附加信息和客户端自身的信息</li></ul></li><li><p>请求正文</p></li></ul></li><li><p>服务器处理并返回 <code>HTTP</code> 报文</p><ul><li>HTTP请求一般可以分为两类，静态资源 和 动态资源。 <ul><li>请求访问静态资源，这个就直接根据<code>url</code>地址去服务器里找就好了。</li><li>请求动态资源的话，就需要web server把不同请求，委托给服务器上处理相应请求的程序进行处理，然后返回后台程序处理产生的结果作为响应，发送到客户端。</li></ul></li></ul></li><li><p>断开连接（<code>TCP/IP</code>四次挥手）</p><ul><li><p>刚开始双方都处于<code>established</code>状态，假如是客户端先发起关闭请求</p></li><li><p>第一次挥手：客户端发送一个<code>FIN</code>报文，报文中会指定一个序列号。此时客户端处于<code>FIN_WAIT1</code>状态</p></li><li><p>第二次挥手：服务端收到<code>FIN</code>之后，会发送<code>ACK</code>报文，且把客户端的序列号值<code>+1</code>作为<code>ACK</code>报文的序列号值，表明已经收到客户端的报文了，此时服务端处于<code>CLOSE_WAIT</code>状态</p></li><li><p>第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发送<code>FIN</code>报文，且指定一个序列号。此时服务端处于<code>LAST_ACK</code>的状态</p></li><li><p>需要过一阵子以确保服务端收到自己的<code>ACK</code>报文之后才会进入<code>CLOSED</code>状态，服务端收到<code>ACK</code>报文之后，就处于关闭连接了，处于<code>CLOSED</code>状态。</p></li></ul></li><li><p>浏览器渲染解析页面(<code>webkit</code>为例)</p><ul><li><p>解析过程：</p><ul><li><code>HTML</code> ➡ <code>DOM</code> 树，内容树 <ul><li><code>Bytes</code> → <code>characters</code> → <code>tokens</code> → <code>nodes</code> → <code>DOM</code></li><li><img src="https://segmentfault.com/img/remote/1460000013662139" alt=""></li></ul></li><li><code>CSS</code> ➡ <code>CSSOM</code> 树</li><li><code>CSSOM</code>树 + <code>DOM</code>树 ➡ 渲染树</li><li>浏览器渲染并绘制页面：浏览器会将各层的信息发送给<code>GPU</code>，<code>GPU</code>会将各层合成（<code>composite</code>），显示在屏幕上 <ul><li>计算<code>CSS</code>样式→ 构建渲染树 → 布局，主要定位坐标和大小，是否换行，各种<code>position overflow z-index</code>属性 →<strong>光栅化</strong> →绘制，将图像绘制出来</li></ul></li></ul><blockquote><p>光栅化：</p></blockquote></li></ul></li></ol><blockquote><p>浏览器到现在知道了文档的结构和每个元素的样式以及页面的集合形状和绘制顺序，将此过程转换为屏幕上的像素成为光栅化。</p><ul><li>在最初的光栅化的处理方式是旨在窗口内对部分页面光栅化，如果用户滚动页面，就移动光栅的架子，通过更多的光栅来填充缺失的部分，优点虚拟滚动的那种感觉。</li><li>现在的方案采用了一种合成的方式，将页面分成多个层，单独光栅化这些页面，并且在合成器线程的单独线程中合并成一个页面。此时如果发生滚动，因为图层被光栅化，所以需要套合成新的框架。</li></ul><p>那么如何知道哪些元素在哪些层级中呢？</p><ul><li>主线程遍历布局树以及对应的创建层数。和 每帧的光栅化的页面小部分相比，为每个元素都提供层，并且合成的话会导致操作很慢。</li></ul><p>光栅的合成？</p><ul><li><p>在创建层并且确定了绘制顺序后，主线程将该信息提交给合成器线程。合成器线程光栅化每一层。并且将一个图层分成多个图块并且将每个图块发送到光栅线程。光山县成光栅化每个图层并且将他们存储在<code>GPU</code>内存中。</p></li><li><p>合成器线程对不同的光栅线程进行优先级排序，以便于首先对视口内容的事务进行光栅化。一个图层也有多个不同分辨率的平铺来处理注入放大操作之类的事情。</p></li><li><p>对切片进行光栅化后，合成线程会收集称为<code>绘制四边形</code>的切片信息以创建<code>合成器框架</code>。</p></li><li><p>然后<code>IPC</code>将合成器框架交给浏览器进程。这些合成器帧会被发送到<code>GPU</code>以将其显示到屏幕上。</p></li></ul><p>为什么合成？</p><ul><li>合成可以在不涉及主线程的情况下完成。不需要等待样式计算或者<code>js</code>执行。</li></ul></blockquote><ul><li><p>解析<code>JavaScript</code> （<code>JS</code>引擎）</p><ul><li><p><strong><code>JS</code>是解释型语言，所以它无需提前编译，而是由解释器实时运行</strong>（即时编译（<code>JIT-Just In Time compiler</code>））</p><ul><li>读取代码，进行词法分析（<code>Lexical analysis</code>），然后将代码分解成词元（<code>token</code>）</li><li>对词元进行语法分析（<code>parsing</code>），然后将代码整理成语法树（<code>syntax tree</code>）</li><li>使用翻译器（<code>translator</code>），将代码转为字节码（<code>bytecode</code>）</li><li>使用字节码解释器（<code>bytecode interpreter</code>），将字节码转为机器码</li></ul></li><li><p>单线程执行</p><ul><li>作为浏览器脚本语言，<code>JavaScript</code>的主要用途是与用户互动，以及操作<code>DOM</code>。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定<code>JavaScript</code>同时有两个线程，一个线程在某个<code>DOM</code>节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</li></ul></li><li><p><code>EventLoop</code>（同步任务和异步任务，宏任务和微任务 ）：</p><blockquote><p>主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为<code>Event Loop</code>（事件循环）。</p></blockquote><ul><li><img src="https://www.ruanyifeng.com/blogimg/asset/2014/bg2014100802.png" alt=""></li><li>上图中，主线程运行的时候，产生堆（<code>heap</code>）和栈（<code>stack</code>），栈中的代码调用各种外部<code>API</code>，它们在&quot;任务队列&quot;中加入各种事件（<code>click</code>，<code>load</code>，<code>done</code>）。只要栈中的代码执行完毕，主线程就会去读取&quot;任务队列&quot;，依次执行那些事件所对应的回调函数。</li><li>需要注意的是，<code>setTimeout()</code>只是将事件插入了&quot;任务队列&quot;，必须等到当前代码（执行栈）执行完，主线程才会去执行它指定的回调函数。要是当前代码耗时很长，有可能要等很久，所以并没有办法保证，回调函数一定会在<code>setTimeout()</code>指定的时间执行。</li></ul></li></ul></li><li><p>回流和重绘：</p><ul><li>回流：浏览器重新计算<code>DOM</code>节点宽高位置。一般意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树</li><li>重绘：浏览器在<code>DOM</code>节点属性确定下来后，绘制内容</li><li>总结： <ul><li><strong>回流的成本开销要高于重绘，而且一个节点的回流往往回导致子节点以及同级节点的回流</strong></li><li><strong>回流一定伴随着重绘，重绘却可以单独出现</strong></li></ul></li></ul></li></ul><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><blockquote><p><a href="https://juejin.cn/post/7039036362653171742" target="_blank" rel="noopener noreferrer">【7000字】一晚上爆肝浏览器从输入到渲染完毕原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/6928677404332425223" target="_blank" rel="noopener noreferrer">阿里面试官的”说一下从url输入到返回请求的过程“问的难度就是不一样！<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/baiziyu-fe/notes/master/docs/浏览器-输入URL网址发生的事情.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: baiziyu-fe@outlook.com">baiziyu-fe</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notes/assets/app.07af11fc.js" defer></script>
  </body>
</html>
